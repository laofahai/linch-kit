ðŸš¨ å¼€å§‹å¼€å‘ session - å¿…é¡»ä¸¥æ ¼éµå¾ªæ‰€æœ‰çº¦æŸ

**å¼ºåˆ¶è¦æ±‚:**

- é˜…è¯»å¹¶éµå®ˆ @CLAUDE.md ä¸­çš„æ‰€æœ‰çº¦æŸ
- éµå®ˆ @ai-context/02_Guides/01_Development_Workflow.md ä¸­çš„å¼€å‘æµç¨‹
- å®Œæˆ Graph RAG å¼ºåˆ¶æŸ¥è¯¢ï¼ˆé›¶å®¹å¿è¿è§„ï¼‰

ä»»åŠ¡: $ARGUMENTS

!echo "ðŸ” [$(date '+%H:%M:%S')] è¾“å…¥éªŒè¯å’Œå®‰å…¨æ£€æŸ¥..."
!if [[-z "$ARGUMENTS"]]; then
echo "âŒ é”™è¯¯ï¼šè¯·æä¾›ä»»åŠ¡æè¿°"
exit 1
fi

!echo "ðŸ” [$(date '+%H:%M:%S')] æ£€æŸ¥å½“å‰åˆ†æ”¯çŠ¶æ€..."
!CURRENT_BRANCH=$(git branch --show-current)
!if [[ "$CURRENT_BRANCH" == "main" ]] || [["$CURRENT_BRANCH" == "master"]] || [["$CURRENT_BRANCH" == "develop"]]; then
echo "âŒ é”™è¯¯ï¼šä¸èƒ½åœ¨ä¿æŠ¤åˆ†æ”¯ $CURRENT_BRANCH ä¸Šå·¥ä½œ"
echo "ðŸ’¡ å»ºè®®ï¼šè¿è¡Œ /new-branch [åŠŸèƒ½å] åˆ›å»ºåŠŸèƒ½åˆ†æ”¯"
exit 1
fi

!echo "ðŸ§  [$(date '+%H:%M:%S')] ä»»åŠ¡å¤æ‚åº¦å’Œè®¾è®¡éœ€æ±‚åˆ†æž..."

!TASK_LEVEL="T1"
!if [[$ARGUMENTS =~ (å®žçŽ°æ–°|æ·»åŠ æ–°|åˆ›å»ºæ–°|é›†æˆ.*API|ä¿®æ”¹æž¶æž„|æ–°åŠŸèƒ½|æ–°æ¨¡å—|æ–°é¡µé¢)]]; then
TASK_LEVEL="T3"
echo "ðŸŽ¯ æ£€æµ‹åˆ° T3 å¼ºåˆ¶çº§ä»»åŠ¡ - éœ€è¦å®Œæ•´æ–¹æ¡ˆè®¾è®¡"
elif [[$ARGUMENTS =~ (å¢žå¼º|é‡æž„|ä¼˜åŒ–|ä¿®å¤.*é€»è¾‘|æ”¹è¿›)]]; then
TASK_LEVEL="T2"  
 echo "âš¡ æ£€æµ‹åˆ° T2 è½»é‡çº§ä»»åŠ¡ - éœ€è¦ç®€åŒ–è®¾è®¡"
elif [[$ARGUMENTS =~ (ä¿®å¤æ‹¼å†™|è°ƒæ•´æ ·å¼|å¢žåŠ æ³¨é‡Š|å¾®è°ƒ|å°ä¿®)]]; then
TASK_LEVEL="T1"
echo "ðŸ”§ æ£€æµ‹åˆ° T1 è±å…çº§ä»»åŠ¡ - è·³è¿‡è®¾è®¡ç›´æŽ¥ç¼–ç "
else

# åŸºäºŽä»»åŠ¡æè¿°é•¿åº¦å’Œå…³é”®è¯çš„æ™ºèƒ½åˆ¤æ–­

if [[${#ARGUMENTS} -gt 150]] || [[$ARGUMENTS =~ (æž¶æž„|é‡æž„|æ€§èƒ½|å¤æ‚|è®¾è®¡|ç®—æ³•)]]; then
TASK_LEVEL="T3"
echo "ðŸŽ¯ æ™ºèƒ½åˆ¤æ–­ä¸º T3 å¼ºåˆ¶çº§ä»»åŠ¡ - éœ€è¦å®Œæ•´æ–¹æ¡ˆè®¾è®¡"
elif [[${#ARGUMENTS} -gt 50]] || [[$ARGUMENTS =~ (åŠŸèƒ½|ç»„ä»¶|æ¨¡å—|é€»è¾‘)]]; then
TASK_LEVEL="T2"
echo "âš¡ æ™ºèƒ½åˆ¤æ–­ä¸º T2 è½»é‡çº§ä»»åŠ¡ - éœ€è¦ç®€åŒ–è®¾è®¡"  
 else
TASK_LEVEL="T1"
echo "ðŸ”§ æ™ºèƒ½åˆ¤æ–­ä¸º T1 è±å…çº§ä»»åŠ¡ - è·³è¿‡è®¾è®¡ç›´æŽ¥ç¼–ç "
fi
fi

!echo "ðŸ“‹ ä»»åŠ¡çº§åˆ«: $TASK_LEVEL"
!if [["$TASK_LEVEL" == "T3"]] || [["$TASK_LEVEL" == "T2"]]; then
echo "ðŸš¨ å¤æ‚ä»»åŠ¡å»ºè®®ï¼š"
echo " â€¢ ä½¿ç”¨ TodoWrite æ‹†åˆ†ä»»åŠ¡"
echo " â€¢ æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡è¿›åº¦"
echo " â€¢ é€‚æ—¶ä½¿ç”¨ /end-session ä¿å­˜çŠ¶æ€"
echo "ðŸ§  å¯ç”¨ thinking æ¨¡å¼è¿›è¡Œæ·±åº¦åˆ†æž"
fi

!echo "ðŸ—ï¸ [$(date '+%H:%M:%S')] å¼€å§‹ Claude ç»¼åˆæž¶æž„åˆ†æž..."

!echo "ðŸ“‹ æ­¥éª¤1: æ‰§è¡Œ Graph RAG çŽ°æœ‰å®žçŽ°æŸ¥è¯¢..."
!GRAPH_RAG_RESULT=$(bun run ai:session query "$ARGUMENTS" 2>&1)
!if [[$? -ne 0]]; then
echo "ðŸš¨ FATAL: Graph RAG æŸ¥è¯¢å¤±è´¥ - è¿™æ˜¯é›¶å®¹å¿è¿è§„"
echo "ðŸ“‹ é”™è¯¯è¯¦æƒ…: $GRAPH_RAG_RESULT"
echo "ðŸ›‘ Claude å¿…é¡»åŸºäºŽé¡¹ç›®ä¸Šä¸‹æ–‡è¿›è¡Œå¼€å‘ï¼ŒæŸ¥è¯¢å¤±è´¥åˆ™åœæ­¢"
exit 1
fi
!echo "âœ… Graph RAG æŸ¥è¯¢å®Œæˆï¼Œæ‰¾åˆ°ç›¸å…³å®žçŽ°"

!echo "ðŸ“‹ æ­¥éª¤2: æŸ¥è¯¢é¡¹ç›®æž¶æž„æ–‡æ¡£..."
!if [[-d "ai-context"]]; then
echo "âœ… ai-context æ–‡æ¡£å¯ç”¨ï¼ŒClaude å°†åˆ†æžæž¶æž„çº¦æŸ"
echo "ðŸ“„ å…³é”®æ–‡æ¡£:"
echo " â€¢ ai-context/01_Concepts/03_Package_Architecture.md (critical)"
echo " â€¢ ai-context/01_Concepts/07_Strategic_Architecture_Evolution.md (critical)"
echo " â€¢ ai-context/02_Guides/01_Development_Workflow.md (constraints)"
else
echo "âš ï¸ ai-context ç›®å½•ä¸å­˜åœ¨ï¼Œæž¶æž„åˆ†æžå—é™"
fi

!echo "ðŸ“‹ æ­¥éª¤3: å‡†å¤‡æ™ºèƒ½ä»£ç æ¨¡å¼åˆ†æž..."
!echo "ðŸ§  Claude å°†åŸºäºŽ Graph RAG æŸ¥è¯¢ç»“æžœæ™ºèƒ½åˆ†æžçŽ°æœ‰ä»£ç æ¨¡å¼"
!echo "ðŸ” Claude å°†è‡ªåŠ¨è¯†åˆ«å¯å¤ç”¨çš„ LinchKit åŒ…å’Œç»„ä»¶"

!echo "ðŸ“‹ æ­¥éª¤4: Claude æž¶æž„åˆ†æžæ‰¿è¯ºæ¿€æ´»..."
!cat > .claude/current-session-analysis.md << EOF

# Claude æž¶æž„åˆ†æžæŠ¥å‘Š - $(date '+%Y-%m-%d %H:%M:%S')

## ä»»åŠ¡: $ARGUMENTS

## Graph RAG æŸ¥è¯¢ç»“æžœ

å·²å®Œæˆé¡¹ç›®ä¸Šä¸‹æ–‡æŸ¥è¯¢ï¼Œå‘çŽ°ç›¸å…³çŽ°æœ‰å®žçŽ°

## æž¶æž„æ–‡æ¡£åˆ†æž

- ai-context æ–‡æ¡£å¯ç”¨
- å°†éµå¾ª LinchKit å½“å‰æž¶æž„åŽŸåˆ™
- é¿å…é‡å¤å®žçŽ°çŽ°æœ‰åŠŸèƒ½

## Claude å¼ºåˆ¶æ‰¿è¯º

æˆ‘æ‰¿è¯ºåœ¨æœ¬æ¬¡å¼€å‘ä¸­ï¼š

1. âœ… åŸºäºŽ Graph RAG æŸ¥è¯¢ç»“æžœå¤ç”¨çŽ°æœ‰å®žçŽ°
2. âœ… éµå¾ª ai-context ä¸­çš„æž¶æž„çº¦æŸ
3. âœ… åˆ†æžçŽ°æœ‰ä»£ç æ¨¡å¼åŽå†ç¼–ç 
4. âœ… ä¼˜å…ˆä½¿ç”¨ LinchKit æ ¸å¿ƒåŒ…åŠŸèƒ½
5. âœ… å‘çŽ°è¿è§„æ—¶ç«‹å³åœæ­¢å¹¶çº æ­£

## åˆ†æžçŠ¶æ€: å·²å®Œæˆ âœ“

çŽ°åœ¨å¯ä»¥åŸºäºŽå®Œæ•´é¡¹ç›®ä¸Šä¸‹æ–‡å¼€å§‹æ™ºèƒ½å¼€å‘
EOF

!echo "ðŸ“š [$(date '+%H:%M:%S')] æ‰§è¡Œè¡¥å…… Context7 æŸ¥è¯¢..."
!if command -v context7 &> /dev/null; then
context7 "$ARGUMENTS" || echo "âš ï¸ Context7 æŸ¥è¯¢å¤±è´¥ï¼Œç»§ç»­ä½¿ç”¨ Graph RAG ç»“æžœ"
else
echo "âš ï¸ Context7 æœªå®‰è£…ï¼Œè·³è¿‡æŸ¥è¯¢"
fi

!echo "ðŸ¤ [$(date '+%H:%M:%S')] æ£€æŸ¥æ˜¯å¦éœ€è¦ Gemini åå•†..."
!if [[$ARGUMENTS =~ (è®¾è®¡|æž¶æž„|æŠ€æœ¯é€‰åž‹|æ–¹æ¡ˆ|å¤æ‚)]]; then
echo "ðŸ’¡ å»ºè®®ä¸ŽGeminiåå•†è®¾è®¡æœ€ä½³å®žè·µ"
echo " ä½¿ç”¨å‘½ä»¤ï¼šä¸ŽGeminiåå•† $ARGUMENTS"
fi

!echo "ðŸ“‹ [$(date '+%H:%M:%S')] æ£€æŸ¥åŒ…å¤ç”¨æƒ…å†µ..."
!if [[-f "tools/dev/check-reuse.mjs"]]; then
bun run deps:check "$ARGUMENTS" || echo "âš ï¸ åŒ…å¤ç”¨æ£€æŸ¥å¤±è´¥"
else
echo "âš ï¸ åŒ…å¤ç”¨æ£€æŸ¥è„šæœ¬ä¸å­˜åœ¨"
fi

!echo "ðŸ¤– [$(date '+%H:%M:%S')] æ¿€æ´» Claude è‡ªæˆ‘ç›‘ç£æœºåˆ¶..."
!cat > .claude/claude-session-monitor.md << EOF

# Claude è‡ªæˆ‘ç›‘ç£ - å½“å‰ä¼šè¯å¼ºåˆ¶çº¦æŸ

## é›¶å®¹å¿çº¦æŸ (è¿åå³ç»ˆæ­¢)

1. ðŸš« ä»»ä½•ç¼–ç å‰å¿…é¡»å…ˆåŸºäºŽ Graph RAG æŸ¥è¯¢ç»“æžœåˆ†æžçŽ°æœ‰å®žçŽ°
2. ðŸš« ç¦æ­¢é‡å¤å®žçŽ°å·²å­˜åœ¨çš„ LinchKit åŠŸèƒ½
3. ðŸš« ç¦æ­¢ä½¿ç”¨ console.log/console.errorï¼Œå¿…é¡»ç”¨ @linch-kit/core logger
4. ðŸš« ç¦æ­¢è·³è¿‡ ai-context æž¶æž„æ–‡æ¡£åˆ†æž
5. ðŸš« ç¦æ­¢åœ¨ä¿æŠ¤åˆ†æ”¯ç›´æŽ¥å·¥ä½œ

## è‡ªæˆ‘æ£€æŸ¥æœºåˆ¶

ç¼–ç å‰è‡ªé—®ï¼š

- "æˆ‘æ˜¯å¦å·²æŸ¥è¯¢å¹¶åˆ†æžäº†çŽ°æœ‰ç›¸å…³å®žçŽ°ï¼Ÿ"
- "æˆ‘æ˜¯å¦ç¡®è®¤æ²¡æœ‰é‡å¤å®žçŽ°çŽ°æœ‰åŠŸèƒ½ï¼Ÿ"
- "æˆ‘æ˜¯å¦éµå¾ªäº†å½“å‰ LinchKit æž¶æž„åŽŸåˆ™ï¼Ÿ"
- "æˆ‘æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ LinchKit æ ¸å¿ƒåŒ…ï¼Ÿ"

## è¿è§„å¤„ç†

å‘çŽ°è¿è§„æ—¶å¿…é¡»ï¼š

1. ç«‹å³åœæ­¢å½“å‰ä»»åŠ¡
2. å…¬å¼€æ‰¿è®¤è¿è§„è¡Œä¸º
3. è§£é‡Šè¿è§„åŽŸå› 
4. é‡æ–°æ‰§è¡Œæ­£ç¡®çš„åˆ†æžæµç¨‹

## ä¼šè¯çŠ¶æ€: æž¶æž„åˆ†æžå·²å®Œæˆ âœ“

EOF

!echo "ðŸŽ¨ [$(date '+%H:%M:%S')] æ ¹æ®ä»»åŠ¡çº§åˆ«å¯åŠ¨ç›¸åº”è®¾è®¡æµç¨‹..."

!if [["$TASK_LEVEL" == "T3"]]; then
echo "ðŸš¨ T3 å¼ºåˆ¶çº§ä»»åŠ¡ - å¯åŠ¨å®Œæ•´æ–¹æ¡ˆè®¾è®¡æµç¨‹"
echo "ðŸ“‹ Claude å°†ç”Ÿæˆè¯¦ç»†è®¾è®¡æ–¹æ¡ˆï¼Œéœ€è¦æ‚¨çš„å®¡æ‰¹åŽæ‰èƒ½å¼€å§‹ç¼–ç "
echo "ðŸ“„ è®¾è®¡æ–¹æ¡ˆå°†åŒ…æ‹¬ï¼šç›®æ ‡ç¡®è®¤ã€å½±å“èŒƒå›´ã€æ ¸å¿ƒè®¾è®¡ã€å¾…æ›´æ–°æ–‡æ¡£ã€æµ‹è¯•ç­–ç•¥"
echo "â¸ï¸ è¯·ç­‰å¾… Claude ç”Ÿæˆæ–¹æ¡ˆ..."

elif [["$TASK_LEVEL" == "T2"]]; then
echo "âš¡ T2 è½»é‡çº§ä»»åŠ¡ - å¯åŠ¨ç®€åŒ–è®¾è®¡æµç¨‹"
echo "ðŸ“‹ Claude å°†ç”Ÿæˆç®€è¦è®¡åˆ’ï¼Œéœ€è¦æ‚¨çš„å¿«é€Ÿç¡®è®¤"
echo "ðŸ“ ç®€è¦è®¡åˆ’å°†åŒ…æ‹¬ï¼šå˜æ›´ç‚¹ã€å½±å“èŒƒå›´ã€å®žçŽ°è¦ç‚¹"
echo "â¸ï¸ è¯·ç­‰å¾… Claude ç”Ÿæˆè®¡åˆ’..."

else
echo "ðŸ”§ T1 è±å…çº§ä»»åŠ¡ - è·³è¿‡è®¾è®¡ï¼Œç›´æŽ¥è¿›å…¥æ™ºèƒ½ç¼–ç "
echo "ðŸš€ åŸºäºŽ Graph RAG æŸ¥è¯¢å’Œæž¶æž„åˆ†æžç»“æžœç›´æŽ¥å¼€å§‹ç¼–ç "
fi

!echo ""
!echo "âœ… [$(date '+%H:%M:%S')] Claude ç»¼åˆåˆ†æžå®Œæˆï¼Œè®¾è®¡æµç¨‹å·²å¯åŠ¨ï¼"
!echo "ðŸš¨ æé†’: Claude å·²æ‰¿è¯ºéµå¾ªæ‰€æœ‰æž¶æž„çº¦æŸï¼ŒåŸºäºŽå®Œæ•´é¡¹ç›®ä¸Šä¸‹æ–‡è¿›è¡Œå¼€å‘"
