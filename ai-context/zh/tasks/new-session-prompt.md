# LinchKit Auth åŒ… DTS æ„å»ºæ€§èƒ½ä¼˜åŒ– - æ–°ä¼šè¯ç»§ç»­æç¤º

## ğŸ¯ é¡¹ç›®èƒŒæ™¯

**LinchKit** æ˜¯ä¸€ä¸ª AI-first ä¼ä¸šçº§å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œé‡‡ç”¨ Odoo é£æ ¼çš„æ¨¡å—åŒ–æ¶æ„ã€‚é¡¹ç›®ä½¿ç”¨ TypeScript + Zod + Prisma + tRPC æŠ€æœ¯æ ˆï¼Œæ”¯æŒå¤šç§æ•°æ®åº“å’Œéƒ¨ç½²æ–¹å¼ã€‚

### æ ¸å¿ƒåŒ…æ¶æ„
- `@linch-kit/schema`: Zod-first æ•°æ®å»ºæ¨¡å’Œä»£ç ç”Ÿæˆ
- `@linch-kit/core`: ç»Ÿä¸€ CLI å’Œé…ç½®ç®¡ç†
- `@linch-kit/auth`: ä¼ä¸šçº§è®¤è¯å’Œæƒé™ç³»ç»Ÿ
- `@linch-kit/ui`: åŸºäº shadcn/ui çš„ç»„ä»¶åº“
- `@linch-kit/crud`: CRUD æ“ä½œå’ŒçŠ¶æ€ç®¡ç†
- `@linch-kit/trpc`: tRPC é›†æˆå’Œç±»å‹å®‰å…¨ API

## ğŸš¨ å½“å‰é—®é¢˜

### ä¸»è¦é—®é¢˜ï¼šAuth åŒ… DTS æ„å»ºè¶…æ—¶
- **ç—‡çŠ¶**: `packages/auth` åŒ…çš„ TypeScript DTS æ„å»ºè¶…æ—¶(>30ç§’)
- **å½±å“**: é˜»å¡æ•´ä¸ªé¡¹ç›®çš„æ„å»ºæµç¨‹ï¼Œä¸¥é‡å½±å“å¼€å‘ä½“éªŒ
- **çŠ¶æ€**: JS/ESM æ„å»ºæ­£å¸¸(~700ms)ï¼Œä»… DTS æ„å»ºæœ‰é—®é¢˜

### å·²å®Œæˆçš„ä¼˜åŒ–
âœ… **Schema åŒ…ç±»å‹ç³»ç»Ÿæ”¹è¿›**ï¼ˆ2025-06-22 å®Œæˆï¼‰
- åˆ†å±‚ç±»å‹ç³»ç»Ÿè®¾è®¡ï¼ˆCoreFieldConfig â†’ SimpleFieldConfig â†’ FieldConfigï¼‰
- defineField å‡½æ•°ä¼˜åŒ–ï¼ˆåŸºç¡€ç‰ˆæœ¬ + é«˜çº§ç‰ˆæœ¬ï¼‰
- defineEntity å‡½æ•°æ”¹è¿›ï¼ˆæ¡ä»¶ç±»å‹ + é™åˆ¶æ³›å‹æ·±åº¦ï¼‰
- **ç»“æœ**: Schema åŒ… DTS æ„å»ºä»æŒ‚èµ·(>30s) ä¼˜åŒ–åˆ° 4.8s âœ…

## ğŸ” é—®é¢˜åˆ†æ

### æ ¸å¿ƒæ¶æ„é—®é¢˜å‡è®¾
**é—®é¢˜æ ¸å¿ƒ**: Auth åŒ…æ„å»ºè¶…æ—¶å¯èƒ½ä¸ Schema åŒ…ä¸­å¤æ‚çš„ UI ç›¸å…³ç±»å‹å®šä¹‰æœ‰å…³

### å…·ä½“åˆ†æç‚¹

#### 1. å¤æ‚ UI ç±»å‹å®šä¹‰çš„å½±å“
å½“å‰ `@linch-kit/schema` åŒ…çš„ `FieldConfig` æ¥å£åŒ…å«å¤§é‡å¤æ‚çš„ UI é…ç½®ï¼š

```typescript
export interface FieldConfig {
  // æ•°æ®åº“é…ç½®ï¼ˆåˆç†ï¼‰
  primary?: boolean
  unique?: boolean
  
  // å¤æ‚çš„ UI é…ç½®ï¼ˆå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼‰
  table?: {
    width?: number | string
    render?: string
    // ... 20+ å±æ€§
  }
  
  form?: {
    type?: 'text' | 'email' | 'password' | ...
    dependencies?: Array<{
      field: string
      condition: any
      action: 'show' | 'hide' | 'enable' | 'disable' | 'require'
    }>
    // ... æ›´å¤šåµŒå¥—é…ç½®
  }
  
  // å¤æ‚å‡½æ•°ç±»å‹
  permissions?: {
    custom?: (user: any, context?: any) => boolean
  }
  
  transform?: {
    input?: (value: any) => any
    output?: (value: any) => any
  }
}
```

#### 2. Auth åŒ…ä¸­çš„å¤æ‚ç±»å‹ä½¿ç”¨
Auth åŒ…ä¸­å¤§é‡ä½¿ç”¨ `defineField` å‡½æ•°ï¼Œå¯èƒ½è§¦å‘å¤æ‚ç±»å‹æ¨å¯¼ï¼š

```typescript
// packages/auth/src/schemas/user.ts
export const User = defineEntity('User', {
  departments: defineField(z.array(z.object({
    departmentId: z.string(),
    position: z.string().optional(),
    // ... å¤æ‚åµŒå¥—å¯¹è±¡
  })).optional(), {
    label: 'auth.user.departments',
    db: { type: 'JSON' },
    // å¯èƒ½è§¦å‘å¤æ‚ UI ç±»å‹æ¨å¯¼
  }),
  
  metadata: defineField(z.record(z.string(), z.unknown()).optional(), {
    label: 'auth.user.metadata',
    db: { type: 'JSON' }
  })
})
```

### å»ºè®®çš„æ¶æ„é‡æ„æ–¹æ¡ˆ

#### æ–¹æ¡ˆï¼šæ¨¡å—æ‰©å±•ï¼ˆModule Augmentationï¼‰
å°† UI ç›¸å…³çš„ç±»å‹å®šä¹‰ä» `@linch-kit/schema` ç§»åŠ¨åˆ° `@linch-kit/ui` åŒ…ï¼š

```typescript
// @linch-kit/schema åŒ…ï¼šåªåŒ…å«æ ¸å¿ƒæ•°æ®åº“ç±»å‹
export interface FieldConfig {
  // æ ¸å¿ƒæ•°æ®åº“é…ç½®
  primary?: boolean
  unique?: boolean
  default?: unknown
  db?: DatabaseConfig
  relation?: RelationConfig
  
  // åŸºç¡€ UI é…ç½®
  label?: string
  description?: string
  required?: boolean
  readonly?: boolean
}

// @linch-kit/ui åŒ…ï¼šé€šè¿‡æ¨¡å—æ‰©å±•æ·»åŠ å¤æ‚ UI ç±»å‹
declare module '@linch-kit/schema' {
  interface FieldConfig {
    // å¤æ‚ UI é…ç½®
    table?: TableConfig
    form?: FormConfig
    permissions?: PermissionConfig
    transform?: TransformConfig
  }
}
```

#### ä¼˜åŠ¿
1. **åŒ…èŒè´£å•ä¸€**: Schema åŒ…ä¸“æ³¨æ•°æ®å»ºæ¨¡ï¼ŒUI åŒ…ä¸“æ³¨ç•Œé¢é…ç½®
2. **æŒ‰éœ€åŠ è½½**: ä¸ä½¿ç”¨ UI åŒ…æ—¶ï¼Œä¸ä¼šå¼•å…¥å¤æ‚ç±»å‹å®šä¹‰
3. **æ„å»ºæ€§èƒ½**: Auth åŒ…åªä¾èµ–ç®€åŒ–çš„ Schema ç±»å‹ï¼Œé¿å…å¤æ‚æ¨å¯¼
4. **å‘åå…¼å®¹**: ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹

## ğŸ¯ éœ€è¦éªŒè¯çš„å‡è®¾

### 1. ç±»å‹å¤æ‚åº¦å‡è®¾
- Auth åŒ… DTS æ„å»ºè¶…æ—¶æ˜¯å¦å› ä¸ºå¯¼å…¥äº†åŒ…å«å¤æ‚ UI ç±»å‹çš„ Schema åŒ…ï¼Ÿ
- å°† UI ç±»å‹åˆ†ç¦»åï¼ŒAuth åŒ…æ„å»ºæ€§èƒ½æ˜¯å¦ä¼šæ˜¾è‘—æ”¹å–„ï¼Ÿ

### 2. æ¨¡å—æ‰©å±•å¯è¡Œæ€§
- TypeScript æ¨¡å—æ‰©å±•æ–¹æ¡ˆæ˜¯å¦èƒ½ä¿æŒç±»å‹å®‰å…¨å’Œå¼€å‘ä½“éªŒï¼Ÿ
- æ˜¯å¦ä¼šå¼•å…¥æ–°çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ

### 3. æ„å»ºæ€§èƒ½å½±å“
- åˆ†ç¦»åçš„æ„å»ºæ—¶é—´æ˜¯å¦èƒ½è¾¾åˆ°ç›®æ ‡ï¼ˆAuth åŒ… DTS < 30sï¼‰ï¼Ÿ
- æ˜¯å¦ä¼šå½±å“å…¶ä»–åŒ…çš„æ„å»ºæ€§èƒ½ï¼Ÿ

## ğŸ”§ æŠ€æœ¯å®ç°è€ƒè™‘

### 1. TypeScript æ¨¡å—æ‰©å±•æœ€ä½³å®è·µ
```typescript
// æ­£ç¡®çš„æ¨¡å—æ‰©å±•æ–¹å¼
declare module '@linch-kit/schema' {
  interface FieldConfig {
    // æ‰©å±•å±æ€§
  }
}

// é¿å…çš„é—®é¢˜
- å¾ªç¯ä¾èµ–
- ç±»å‹å†²çª
- æ„å»ºé¡ºåºé—®é¢˜
```

### 2. åŒ…ä¾èµ–å…³ç³»é‡æ–°è®¾è®¡
```
å½“å‰ä¾èµ–å…³ç³»:
@linch-kit/auth â†’ @linch-kit/schema (åŒ…å«å¤æ‚ UI ç±»å‹)

å»ºè®®ä¾èµ–å…³ç³»:
@linch-kit/auth â†’ @linch-kit/schema (ä»…æ ¸å¿ƒç±»å‹)
@linch-kit/ui â†’ @linch-kit/schema (æ‰©å±• UI ç±»å‹)
```

### 3. å‘åå…¼å®¹æ€§ä¿è¯
- ç°æœ‰çš„ `defineField` è°ƒç”¨æ— éœ€ä¿®æ”¹
- ç±»å‹æ¨å¯¼ç»“æœä¿æŒä¸€è‡´
- è¿è¡Œæ—¶åŠŸèƒ½å®Œå…¨ä¿æŒ

### 4. æ„å»ºæ€§èƒ½ç›‘æ§
```typescript
// æ·»åŠ æ„å»ºæ—¶é—´ç›‘æ§
plugins: [
  {
    name: 'dts-performance-monitor',
    buildStart() {
      console.time('DTSæ„å»ºæ—¶é—´')
    },
    buildEnd() {
      console.timeEnd('DTSæ„å»ºæ—¶é—´')
      // è¶…è¿‡é˜ˆå€¼æ—¶å‘å‡ºè­¦å‘Š
    }
  }
]
```

## ğŸ“‹ å…·ä½“ä»»åŠ¡æ¸…å•

### é˜¶æ®µ1ï¼šé—®é¢˜éªŒè¯ï¼ˆä¼˜å…ˆçº§ï¼šğŸ”¥ é«˜ï¼‰
1. **åˆ†æ Auth åŒ…ä¸­çš„å…·ä½“ç±»å‹ä½¿ç”¨**
   - æ£€æŸ¥æ‰€æœ‰ `defineField` è°ƒç”¨
   - è¯†åˆ«å¤æ‚çš„é…ç½®ä½¿ç”¨
   - åˆ†æç±»å‹æ¨å¯¼é“¾

2. **åˆ›å»ºæœ€å°åŒ–å¤ç°æµ‹è¯•**
   - åˆ›å»ºç®€åŒ–çš„ Auth schema æ–‡ä»¶
   - æµ‹è¯• DTS æ„å»ºæ€§èƒ½
   - ç¡®è®¤é—®é¢˜æ ¹æº

### é˜¶æ®µ2ï¼šæ¶æ„é‡æ„ï¼ˆä¼˜å…ˆçº§ï¼šğŸ”¥ é«˜ï¼‰
1. **é‡æ„ Schema åŒ…ç±»å‹å®šä¹‰**
   - åˆ†ç¦»æ ¸å¿ƒç±»å‹å’Œ UI ç±»å‹
   - åˆ›å»º CoreFieldConfig æ¥å£
   - ä¿æŒå‘åå…¼å®¹

2. **å®ç°æ¨¡å—æ‰©å±•æ–¹æ¡ˆ**
   - åœ¨ UI åŒ…ä¸­å®ç°ç±»å‹æ‰©å±•
   - éªŒè¯ç±»å‹å®‰å…¨æ€§
   - æµ‹è¯•æ„å»ºæ€§èƒ½

### é˜¶æ®µ3ï¼šéªŒè¯å’Œä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šğŸŸ¡ ä¸­ï¼‰
1. **æ„å»ºæ€§èƒ½éªŒè¯**
   - Auth åŒ… DTS æ„å»º < 30s
   - å…¶ä»–åŒ…æ„å»ºæ€§èƒ½ä¸å—å½±å“
   - æ•´ä½“é¡¹ç›®æ„å»ºæ—¶é—´ä¼˜åŒ–

2. **åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•**
   - ç±»å‹æ¨å¯¼æ­£å¸¸å·¥ä½œ
   - IDE æ™ºèƒ½æç¤ºå¯ç”¨
   - è¿è¡Œæ—¶åŠŸèƒ½ä¿æŒ

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æ„å»ºæ€§èƒ½ç›®æ ‡
- âœ… Schema åŒ… DTS æ„å»º < 10sï¼ˆå·²è¾¾æˆï¼š4.8sï¼‰
- ğŸ¯ Auth åŒ… DTS æ„å»º < 30sï¼ˆå¾…è¾¾æˆï¼‰
- ğŸ¯ æ•´ä½“é¡¹ç›®æ„å»ºæ—¶é—´ < 2 åˆ†é’Ÿ

### åŠŸèƒ½å®Œæ•´æ€§ç›®æ ‡
- ğŸ¯ ç±»å‹æ¨å¯¼ç²¾åº¦ä¿æŒ 100%
- ğŸ¯ IDE æ™ºèƒ½æç¤ºå®Œå…¨å¯ç”¨
- ğŸ¯ è¿è¡Œæ—¶åŠŸèƒ½ 100% ä¿æŒ
- ğŸ¯ å‘åå…¼å®¹æ€§ 100% ä¿è¯

### å¼€å‘ä½“éªŒç›®æ ‡
- ğŸ¯ æ„å»ºè¿‡ç¨‹ä¸å†æŒ‚èµ·
- ğŸ¯ é”™è¯¯ä¿¡æ¯æ¸…æ™°æ˜ç¡®
- ğŸ¯ çƒ­é‡è½½æ€§èƒ½è‰¯å¥½

## ğŸ“ ä¸Šä¸‹æ–‡ä¿¡æ¯

### é¡¹ç›®ç»“æ„
```
linch-kit/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ schema/     # Zod-first æ•°æ®å»ºæ¨¡ï¼ˆå·²ä¼˜åŒ–ï¼‰
â”‚   â”œâ”€â”€ auth/       # è®¤è¯ç³»ç»Ÿï¼ˆå¾…ä¼˜åŒ–ï¼‰
â”‚   â”œâ”€â”€ ui/         # UI ç»„ä»¶åº“
â”‚   â””â”€â”€ ...
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ starter/    # ç¤ºä¾‹åº”ç”¨
â””â”€â”€ ai-context/     # AI ä¸Šä¸‹æ–‡æ–‡æ¡£
```

### ç›¸å…³æ–‡æ¡£
- [å½“å‰è¿›å±•](./current-progress.md)
- [Schema ç±»å‹ç³»ç»Ÿåˆ†æ](./schema-type-system-analysis.md)
- [å¼€å‘æ ‡å‡†](../standards/development-standards.md)

### æŠ€æœ¯æ ˆ
- **è¯­è¨€**: TypeScript 5.0+
- **æ„å»º**: tsup + Turborepo
- **åŒ…ç®¡ç†**: pnpm
- **æ•°æ®åº“**: Prisma + PostgreSQL
- **éªŒè¯**: Zod
- **API**: tRPC

---

**ä¼šè¯ç›®æ ‡**: è§£å†³ Auth åŒ… DTS æ„å»ºè¶…æ—¶é—®é¢˜ï¼Œå®ç°æ¶æ„ä¼˜åŒ–
**é¢„æœŸæ—¶é•¿**: 2-3 å°æ—¶
**æˆåŠŸæ ‡å‡†**: Auth åŒ… DTS æ„å»º < 30 ç§’ï¼ŒåŠŸèƒ½å®Œæ•´æ€§ 100% ä¿æŒ
