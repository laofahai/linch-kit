# Schema ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ¯ è®¾è®¡ç†å¿µ

Schema ç³»ç»Ÿæ˜¯ Linch Kit çš„æ ¸å¿ƒï¼Œé‡‡ç”¨ **Zod-First** çš„è®¾è®¡ç†å¿µï¼š
- **å•ä¸€æ•°æ®æº**: æ‰€æœ‰æ•°æ®ç»“æ„å®šä¹‰éƒ½æ¥è‡ª Zod Schema
- **è‡ªåŠ¨ç”Ÿæˆ**: ä» Schema è‡ªåŠ¨ç”Ÿæˆ Prismaã€éªŒè¯å™¨ã€Mock æ•°æ®ç­‰
- **ç±»å‹å®‰å…¨**: ç«¯åˆ°ç«¯çš„ TypeScript ç±»å‹å®‰å…¨
- **å¼€å‘ä½“éªŒ**: ç®€åŒ–å¼€å‘æµç¨‹ï¼Œå‡å°‘é‡å¤å·¥ä½œ

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TD
    A[Zod Schema å®šä¹‰] --> B[è£…é¥°å™¨ç³»ç»Ÿ]
    B --> C[å®ä½“æ³¨å†Œè¡¨]
    C --> D[ä»£ç ç”Ÿæˆå™¨]
    
    D --> E[Prisma Schema]
    D --> F[éªŒè¯å™¨]
    D --> G[Mock æ•°æ®]
    D --> H[OpenAPI æ–‡æ¡£]
    
    I[CLI å·¥å…·] --> C
    I --> D
    
    J[é…ç½®æ–‡ä»¶] --> I
    K[å®ä½“å‘ç°] --> C
```

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### 1. è£…é¥°å™¨ç³»ç»Ÿ (`src/core/decorators.ts`)

æä¾›è¯­ä¹‰åŒ–çš„å­—æ®µè£…é¥°å™¨ï¼š

```typescript
// åŸºç¡€è£…é¥°å™¨
primary(schema)           // ä¸»é”®
unique(schema)            // å”¯ä¸€çº¦æŸ
defaultValue(schema, val) // é»˜è®¤å€¼

// æ—¶é—´æˆ³è£…é¥°å™¨
createdAt(schema)         // åˆ›å»ºæ—¶é—´
updatedAt(schema)         // æ›´æ–°æ—¶é—´
softDelete(schema)        // è½¯åˆ é™¤

// æ•°æ®åº“è£…é¥°å™¨
dbField(schema, name)     // å­—æ®µæ˜ å°„
dbType(schema, type, opts) // æ•°æ®åº“ç±»å‹

// å…³ç³»è£…é¥°å™¨ (è§„åˆ’ä¸­)
relation(schema, target, type, opts) // å…³ç³»å®šä¹‰
```

### 2. å®ä½“å®šä¹‰ç³»ç»Ÿ (`src/core/entity.ts`)

```typescript
// å®ä½“å®šä¹‰
const User = defineEntity('User', {
  id: primary(z.string().uuid()),
  email: unique(z.string().email()),
  name: z.string(),
  isActive: defaultValue(z.boolean(), true),
  createdAt: createdAt(z.date()),
  updatedAt: updatedAt(z.date()),
  deletedAt: softDelete(z.date().optional()),
}, {
  tableName: 'users',
  indexes: [
    { fields: ['email'], unique: true },
    { fields: ['deletedAt'] },
  ]
})

// è‡ªåŠ¨ç”Ÿæˆçš„éªŒè¯å™¨
User.createSchema    // åˆ›å»ºéªŒè¯å™¨
User.updateSchema    // æ›´æ–°éªŒè¯å™¨
User.responseSchema  // å“åº”éªŒè¯å™¨
```

### 3. ä»£ç ç”Ÿæˆå™¨

#### Prisma ç”Ÿæˆå™¨ (`src/generators/prisma.ts`)
- å°† Zod Schema è½¬æ¢ä¸º Prisma Schema
- å¤„ç†å­—æ®µç±»å‹æ˜ å°„
- ç”Ÿæˆç´¢å¼•å’Œçº¦æŸ
- æ”¯æŒå¤šç§æ•°æ®åº“

#### éªŒè¯å™¨ç”Ÿæˆå™¨ (`src/generators/validators.ts`)
- ç”Ÿæˆ CRUD éªŒè¯å™¨
- è‡ªåŠ¨æ’é™¤ç³»ç»Ÿå­—æ®µ
- æ”¯æŒæŸ¥è¯¢å‚æ•°éªŒè¯
- ç”Ÿæˆåˆ†é¡µå“åº”éªŒè¯å™¨

#### Mock ç”Ÿæˆå™¨ (`src/generators/mock.ts`)
- æ ¹æ® Schema ç”ŸæˆçœŸå®æ•°æ®
- æ”¯æŒè‡ªå®šä¹‰ç”Ÿæˆå™¨
- å¤„ç†å…³ç³»æ•°æ®
- ç”Ÿæˆæµ‹è¯•æ•°æ®æ–‡ä»¶

#### OpenAPI ç”Ÿæˆå™¨ (`src/generators/openapi.ts`)
- ç”Ÿæˆ OpenAPI 3.0 è§„èŒƒ
- è‡ªåŠ¨ç”Ÿæˆ API è·¯å¾„
- æ”¯æŒå¤æ‚æ•°æ®ç±»å‹
- ç”Ÿæˆå®Œæ•´çš„ API æ–‡æ¡£

### 4. CLI å·¥å…· (`src/cli/index.ts`)

```bash
# åˆå§‹åŒ–é…ç½®
linch-schema init

# ç”Ÿæˆä»£ç 
linch-schema generate:prisma
linch-schema generate:validators
linch-schema generate:mocks
linch-schema generate:openapi
linch-schema generate:all

# å·¥å…·å‘½ä»¤
linch-schema list           # åˆ—å‡ºå®ä½“
linch-schema show User      # æ˜¾ç¤ºå®ä½“è¯¦æƒ…
```

### 5. é…ç½®ç³»ç»Ÿ (`src/config/loader.ts`)

æ”¯æŒé…ç½®æ–‡ä»¶ `linch-schema.config.js`:

```javascript
export default {
  entities: ['src/entities/**/*.{ts,js}'],
  output: {
    prisma: './prisma/schema.prisma',
    validators: './src/validators/generated.ts',
    mocks: './src/mocks/factories.ts',
    openapi: './docs/api.json',
  },
  database: {
    provider: 'postgresql',
    url: process.env.DATABASE_URL,
  },
  api: {
    title: 'My API',
    version: '1.0.0',
  },
}
```

## ğŸ”„ å·¥ä½œæµç¨‹

### å¼€å‘æµç¨‹
1. **å®šä¹‰å®ä½“**: ä½¿ç”¨ Zod + è£…é¥°å™¨å®šä¹‰æ•°æ®ç»“æ„
2. **ç”Ÿæˆä»£ç **: è¿è¡Œ CLI å‘½ä»¤ç”Ÿæˆæ‰€æœ‰ç›¸å…³ä»£ç 
3. **æ•°æ®åº“è¿ç§»**: ä½¿ç”¨ Prisma è¿›è¡Œæ•°æ®åº“è¿ç§»
4. **ä¸šåŠ¡å¼€å‘**: ä½¿ç”¨ç”Ÿæˆçš„éªŒè¯å™¨å’Œç±»å‹è¿›è¡Œä¸šåŠ¡å¼€å‘

### ç”Ÿæˆæµç¨‹
1. **å®ä½“å‘ç°**: CLI æ‰«æé¡¹ç›®ä¸­çš„å®ä½“æ–‡ä»¶
2. **å®ä½“æ³¨å†Œ**: å°†å®ä½“æ³¨å†Œåˆ°å…¨å±€æ³¨å†Œè¡¨
3. **ä»£ç ç”Ÿæˆ**: æ ¹æ®å®ä½“å®šä¹‰ç”Ÿæˆå„ç§ä»£ç 
4. **æ–‡ä»¶å†™å…¥**: å°†ç”Ÿæˆçš„ä»£ç å†™å…¥æŒ‡å®šä½ç½®

## ğŸ¯ è®¾è®¡ä¼˜åŠ¿

### 1. å¼€å‘æ•ˆç‡
- **ä¸€æ¬¡å®šä¹‰ï¼Œå¤šå¤„ä½¿ç”¨**: Schema å®šä¹‰ä¸€æ¬¡ï¼Œè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰ç›¸å…³ä»£ç 
- **ç±»å‹å®‰å…¨**: ç«¯åˆ°ç«¯çš„ç±»å‹æ£€æŸ¥ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
- **è‡ªåŠ¨åŒ–**: å‡å°‘æ‰‹åŠ¨ç¼–å†™é‡å¤ä»£ç 

### 2. ç»´æŠ¤æ€§
- **å•ä¸€æ•°æ®æº**: æ‰€æœ‰æ•°æ®ç»“æ„å˜æ›´åªéœ€ä¿®æ”¹ Schema
- **è‡ªåŠ¨åŒæ­¥**: ä»£ç ç”Ÿæˆç¡®ä¿å„éƒ¨åˆ†ä¿æŒåŒæ­¥
- **æ¸…æ™°ç»“æ„**: è£…é¥°å™¨æä¾›è¯­ä¹‰åŒ–çš„å­—æ®µå®šä¹‰

### 3. æ‰©å±•æ€§
- **æ’ä»¶åŒ–**: ç”Ÿæˆå™¨å¯ä»¥ç‹¬ç«‹æ‰©å±•
- **å¤šæ•°æ®åº“**: æ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹
- **è‡ªå®šä¹‰**: æ”¯æŒè‡ªå®šä¹‰è£…é¥°å™¨å’Œç”Ÿæˆå™¨

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸ (1-2 ä¸ªæœˆ)
- [ ] å…³ç³»ç³»ç»Ÿå®Œå–„
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æµ‹è¯•è¦†ç›–
- [ ] é”™è¯¯å¤„ç†æ”¹è¿›

### ä¸­æœŸ (3-6 ä¸ªæœˆ)
- [ ] å›¾å½¢åŒ– Schema ç¼–è¾‘å™¨
- [ ] æ•°æ®åº“è¿ç§»å·¥å…·
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] æ’ä»¶å¸‚åœº

### é•¿æœŸ (6+ ä¸ªæœˆ)
- [ ] å¯è§†åŒ–æ•°æ®å»ºæ¨¡
- [ ] å®æ—¶ Schema åŒæ­¥
- [ ] äº‘ç«¯ Schema ç®¡ç†
- [ ] AI è¾…åŠ© Schema è®¾è®¡

## ğŸš¨ æŠ€æœ¯æŒ‘æˆ˜

### 1. ç±»å‹å¤æ‚æ€§
- **é—®é¢˜**: éšç€åŠŸèƒ½å¢åŠ ï¼Œç±»å‹å®šä¹‰å˜å¾—å¤æ‚
- **è§£å†³**: ç®€åŒ–ç±»å‹æ¥å£ï¼Œæä¾›æ›´å¥½çš„ç±»å‹æ¨æ–­

### 2. æ€§èƒ½é—®é¢˜
- **é—®é¢˜**: å¤§å‹ Schema çš„ç”Ÿæˆå¯èƒ½è¾ƒæ…¢
- **è§£å†³**: å¢é‡ç”Ÿæˆï¼Œç¼“å­˜æœºåˆ¶

### 3. å…¼å®¹æ€§
- **é—®é¢˜**: ä¸åŒç‰ˆæœ¬çš„ Zod/Prisma å…¼å®¹æ€§
- **è§£å†³**: æ˜ç¡®ç‰ˆæœ¬ä¾èµ–ï¼Œæä¾›è¿ç§»æŒ‡å—

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

- **å¼€å‘æ•ˆç‡**: å‡å°‘ 70% çš„é‡å¤ä»£ç ç¼–å†™
- **é”™è¯¯ç‡**: å‡å°‘ 50% çš„ç±»å‹ç›¸å…³é”™è¯¯
- **ä¸Šæ‰‹æ—¶é—´**: æ–°å¼€å‘è€… 30 åˆ†é’Ÿå†…ä¸Šæ‰‹
- **ç¤¾åŒºé‡‡ç”¨**: 6 ä¸ªæœˆå†… 1000+ ä¸‹è½½é‡
