# LinchKit ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

**é¡¹ç›®ç‰ˆæœ¬**: v2.0.3 - æœ€ç»ˆæ¶æ„ç¡®è®¤  
**æ›´æ–°**: 2025-07-14  
**çŠ¶æ€**: åŸºäºå®é™…ä»£ç åˆ†æå’ŒGeminiæ¶æ„åå•†çš„æœ€ç»ˆç¡®è®¤ç‰ˆæœ¬

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„åŸåˆ™

> è¯¦ç»†çš„è®¾è®¡å“²å­¦å’ŒåŸåˆ™è¯·å‚è€ƒ [æ ¸å¿ƒè®¾è®¡åŸåˆ™](./01_Core_Principles.md) å’Œ [å®Œæ•´æ¶æ„è®¾è®¡](./04_Complete_Architecture.md)

### æœ€ç»ˆæ¶æ„åˆ†å±‚ âœ… å·²éªŒè¯

> è¯¦ç»†çš„åŒ…ä¾èµ–å…³ç³»å’Œçº¦æŸè¯·å‚è€ƒ [åŒ…æ¶æ„è®¾è®¡](./03_Package_Architecture.md)

```
ğŸ—ï¸ LinchKit æœ€ç»ˆæ¶æ„ (åŸºäºå®é™…åˆ†æ)
â”œâ”€â”€ apps/starter/        # ğŸ¯ è½»é‡çº§å®¿ä¸»å®¹å™¨
â”œâ”€â”€ extensions/console/  # â­ ä¼ä¸šåŠŸèƒ½åº“ v2.0.3
â””â”€â”€ packages/*          # âœ… å®Œæ•´åŸºç¡€è®¾æ–½
    â”œâ”€â”€ @linch-kit/core      # ExtensionManager + æ ¸å¿ƒåŠŸèƒ½
    â”œâ”€â”€ @linch-kit/platform  # PlatformManager + ä¸šåŠ¡æ”¯æŒ
    â”œâ”€â”€ @linch-kit/auth      # NextAuth.js é›†æˆ
    â””â”€â”€ @linch-kit/ui        # shadcn/ui ç»„ä»¶åº“
```

## ğŸ¯ æœ€ç»ˆä¸‰å±‚æ¶æ„è®¾è®¡ (åŸºäºåˆ†æç¡®è®¤)

### å®¿ä¸»å®¹å™¨å±‚ (Host Container) âœ…

```
apps/starter/       # è½»é‡çº§å®¿ä¸»å®¹å™¨ - é€šè¿‡StarterIntegrationManageré›†æˆextensions
```

**âœ… å®¿ä¸»å®¹å™¨ç‰¹ç‚¹** (å·²éªŒè¯):

- **è¿è¡Œç¯å¢ƒ**: æä¾›Next.jsè¿è¡Œç¯å¢ƒå’ŒåŸºç¡€è®¾æ–½ âœ…
- **æ‰©å±•é›†æˆ**: é€šè¿‡StarterIntegrationManageræ— ç¼é›†æˆconsole âœ…
- **è·¯ç”±ä»£ç†**: ä¸ºæ‰©å±•æä¾›è·¯ç”±å’Œå¯¼èˆªæ”¯æŒ âœ…
- **æ¸è¿›æ¶æ„**: ä»ç©ºshellåˆ°å®Œæ•´ä¼ä¸šåº”ç”¨çš„å¹³æ»‘æ¼”è¿› âœ…

### åŠŸèƒ½åº“å±‚ (Feature Libraries) âœ…

> è¯¦ç»†çš„Extensionç³»ç»Ÿè®¾è®¡å’Œæ¶æ„è¯·å‚è€ƒ [Extensionç³»ç»Ÿ](./10_Extension_System.md)

```
extensions/console/  # â­ ä¼ä¸šçº§ç®¡ç†åŠŸèƒ½åº“ v2.0.3 (æˆç†Ÿå®Œæ•´)
extensions/blog-extension/  # åšå®¢åŠŸèƒ½æ‰©å±•
extensions/example-counter/ # ç¤ºä¾‹è®¡æ•°å™¨
```

**âœ… åŠŸèƒ½åº“ç‰¹ç‚¹** (å·²éªŒè¯):

- **æˆç†ŸåŠŸèƒ½åº“**: Console v2.0.3æä¾›å®Œæ•´çš„ä¼ä¸šç®¡ç†åŠŸèƒ½ âœ…
- **ä¸“é—¨é›†æˆ**: StarterIntegrationManagerä¸“é—¨å¤„ç†ä¸starterçš„é›†æˆ âœ…
- **å®Œæ•´ç‰¹æ€§**: Dashboardã€TenantManagerã€ExtensionManagerç­‰ âœ…
- **éœ€è¦å®¿ä¸»**: æ˜ç¡®å®šä½ä¸ºåŠŸèƒ½åº“ï¼Œéœ€è¦å®¿ä¸»åº”ç”¨ âœ…

### åŸºç¡€è®¾æ–½å±‚ (Infrastructure Packages) âœ…

```
@linch-kit/core/     # æ‰©å±•å¼•æ“ + æ ¸å¿ƒåŠŸèƒ½ (ExtensionManager)
@linch-kit/platform/ # ä¸šåŠ¡å¹³å°æ”¯æŒ (PlatformManager + DashboardLayout)
@linch-kit/auth/     # è®¤è¯æˆæƒç³»ç»Ÿ (NextAuth.jsæ·±åº¦é›†æˆ)
@linch-kit/ui/       # ä¼ä¸šçº§ç»„ä»¶åº“ (shadcn/uiå®Œæ•´é›†æˆ)
```

**âœ… åŸºç¡€è®¾æ–½ç‰¹ç‚¹** (å·²éªŒè¯):

- **å®Œæ•´åŸºç¡€è®¾æ–½**: packages/*å·²å½¢æˆå®Œæ•´çš„åŸºç¡€è®¾æ–½å±‚ âœ…
- **æ‰©å±•å¼•æ“**: @linch-kit/coreæä¾›ExtensionManagerç­‰å®Œæ•´æ‰©å±•ç³»ç»Ÿ âœ…
- **æˆç†Ÿé›†æˆ**: NextAuth.jsã€shadcn/uiç­‰æˆç†ŸæŠ€æœ¯æ ˆæ·±åº¦é›†æˆ âœ…
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ä¸¥æ ¼æ¨¡å¼æ”¯æŒ âœ…

### åŸºç¡€è®¾æ–½å±‚ (Infrastructure)

```
æ•°æ®åº“: PostgreSQL + Prisma
è®¤è¯: NextAuth.js 5.0
æƒé™: CASL (èƒ½åŠ›è®¿é—®æ§åˆ¶)
UI: Tailwind CSS 4 + shadcn/ui
AI: Neo4j çŸ¥è¯†å›¾è°± + Graph RAG
```

## ğŸ“¦ æ ¸å¿ƒåŒ…è¯¦ç»†æ¶æ„ (åŸºäºå®é™…ä»£ç éªŒè¯)

### âœ… @linch-kit/core (æ‰©å±•å¼•æ“ + åŸºç¡€è®¾æ–½)

**å®é™…èŒè´£**: æ‰©å±•ç³»ç»Ÿ + åŸºç¡€è®¾æ–½ (å·²éªŒè¯å®ç°)

**å·²éªŒè¯æ ¸å¿ƒåŠŸèƒ½**:

- **æ‰©å±•å¼•æ“**: ExtensionManager - å®Œæ•´çš„æ‰©å±•åŠ è½½å’Œç®¡ç† âœ…
- **æ‰©å±•ä¸Šä¸‹æ–‡**: ExtensionContext - æ‰©å±•è¿è¡Œç¯å¢ƒ âœ…
- **æ‰©å±•æ³¨å†Œ**: ExtensionRegistry - æ‰©å±•æ³¨å†Œå’Œå‘ç° âœ…
- **æ—¥å¿—ç³»ç»Ÿ**: Logger - ç»“æ„åŒ–æ—¥å¿—è®°å½• âœ…
- **é…ç½®ç®¡ç†**: ConfigManager - ç»Ÿä¸€é…ç½®ç®¡ç† âœ…
- **å›½é™…åŒ–**: i18nç³»ç»Ÿ - å¤šè¯­è¨€æ”¯æŒ âœ…

```typescript
// å·²éªŒè¯å¯¼å‡º (packages/core/src/index.ts)
export * from './extension'
export { ExtensionRegistry } from './extension'
export { ConfigManager } from './config'
export { Logger } from './logger'
export { i18n } from './i18n'
```

### L1: @linch-kit/schema (Schemaå¼•æ“)

**èŒè´£**: Schema å®šä¹‰ã€éªŒè¯å’Œç±»å‹ç”Ÿæˆ

**æ ¸å¿ƒåŠŸèƒ½**:

- **å®ä½“å®šä¹‰**: `defineEntity()` API
- **å…³ç³»å®šä¹‰**: å®ä½“é—´å…³ç³»å»ºæ¨¡
- **ç±»å‹ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹
- **éªŒè¯è§„åˆ™**: Zod éªŒè¯é›†æˆ
- **æ•°æ®åº“é›†æˆ**: Prisma Schema ç”Ÿæˆ

```typescript
// ä½¿ç”¨ç¤ºä¾‹
import { defineEntity } from '@linch-kit/schema'

export const UserSchema = defineEntity('User', {
  id: z.string().uuid(),
  name: z.string().min(1),
  email: z.string().email(),
  role: z.enum(['USER', 'ADMIN']),
})
```

### L2: @linch-kit/auth (è®¤è¯æƒé™)

**èŒè´£**: ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½**:

- **è®¤è¯é›†æˆ**: NextAuth.js 5.0 é›†æˆ
- **æƒé™æ§åˆ¶**: CASL èƒ½åŠ›è®¿é—®æ§åˆ¶
- **ä¼šè¯ç®¡ç†**: ç±»å‹å®‰å…¨çš„ä¼šè¯å¤„ç†
- **å¤šç§Ÿæˆ·**: ç§Ÿæˆ·çº§åˆ«çš„æƒé™éš”ç¦»
- **è§’è‰²ç®¡ç†**: RBAC è§’è‰²æƒé™æ¨¡å‹

```typescript
// ä½¿ç”¨ç¤ºä¾‹
import { requireAuth, can } from '@linch-kit/auth'

const user = await requireAuth(request)
if (can(user, 'read', 'User')) {
  // ç”¨æˆ·æœ‰è¯»å–ç”¨æˆ·çš„æƒé™
}
```

### L2: @linch-kit/crud (CRUDæ“ä½œ)

**èŒè´£**: é€šç”¨çš„å¢åˆ æ”¹æŸ¥æ“ä½œ

**æ ¸å¿ƒåŠŸèƒ½**:

- **ç±»å‹å®‰å…¨ CRUD**: åŸºäº Schema çš„ CRUD æ“ä½œ
- **æƒé™é›†æˆ**: ä¸ @linch-kit/auth æ·±åº¦é›†æˆ
- **æŸ¥è¯¢æ„å»º**: ç±»å‹å®‰å…¨çš„æŸ¥è¯¢ API
- **æ•°æ®éªŒè¯**: è‡ªåŠ¨æ•°æ®éªŒè¯å’Œæ¸…ç†
- **å…³ç³»å¤„ç†**: å¤æ‚å…³ç³»çš„ CRUD æ”¯æŒ

```typescript
// ä½¿ç”¨ç¤ºä¾‹
import { createCRUD } from '@linch-kit/crud'

const userCRUD = createCRUD(UserSchema)
const user = await userCRUD.create({ name: 'John', email: 'john@example.com' })
```

### L3: @linch-kit/trpc (APIå±‚)

**èŒè´£**: ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨çš„ API

**æ ¸å¿ƒåŠŸèƒ½**:

- **tRPC é›†æˆ**: å®Œæ•´çš„ tRPC æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
- **ç±»å‹å®‰å…¨**: ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- **ä¸­é—´ä»¶ç³»ç»Ÿ**: è®¤è¯ã€æƒé™ã€æ—¥å¿—ä¸­é—´ä»¶
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **API ç”Ÿæˆ**: åŸºäº Schema è‡ªåŠ¨ç”Ÿæˆ API

```typescript
// ä½¿ç”¨ç¤ºä¾‹
import { createRouter } from '@linch-kit/trpc'

export const userRouter = createRouter().query('getUser', {
  input: z.string(),
  resolve: async ({ input, ctx }) => {
    return await ctx.db.user.findUnique({ where: { id: input } })
  },
})
```

### L3: @linch-kit/ui (UIç»„ä»¶)

**èŒè´£**: å¯å¤ç”¨çš„ UI ç»„ä»¶åº“

**æ ¸å¿ƒåŠŸèƒ½**:

- **shadcn/ui é›†æˆ**: ç°ä»£ UI ç»„ä»¶åº“
- **ä¸»é¢˜ç³»ç»Ÿ**: Tailwind CSS 4 ä¸»é¢˜æ”¯æŒ
- **è¡¨å•ç»„ä»¶**: åŸºäº Schema çš„è¡¨å•ç”Ÿæˆ
- **æ•°æ®å±•ç¤º**: è¡¨æ ¼ã€åˆ—è¡¨ç­‰æ•°æ®ç»„ä»¶
- **ä¼ä¸šç»„ä»¶**: å¤æ‚çš„ä¼ä¸šçº§ UI ç»„ä»¶

```typescript
// ä½¿ç”¨ç¤ºä¾‹
import { Button, Form, DataTable } from '@linch-kit/ui'

<Form schema={UserSchema} onSubmit={handleSubmit} />
<DataTable data={users} columns={userColumns} />
```

### L4: extensions/console (ç®¡ç†å¹³å°)

**èŒè´£**: ä¼ä¸šçº§ç®¡ç†æ§åˆ¶å°

**æ ¸å¿ƒåŠŸèƒ½**:

- **å¤šç§Ÿæˆ·ç®¡ç†**: ç§Ÿæˆ·åˆ›å»ºã€é…ç½®ã€ç›‘æ§
- **ç”¨æˆ·æƒé™ç®¡ç†**: ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç®¡ç†ç•Œé¢
- **ç³»ç»Ÿç›‘æ§**: ç³»ç»ŸçŠ¶æ€ã€æ€§èƒ½ç›‘æ§
- **å®¡è®¡æ—¥å¿—**: æ“ä½œæ—¥å¿—æŸ¥çœ‹å’Œåˆ†æ
- **å¯åµŒå…¥è®¾è®¡**: å¯ä»¥è¢«åº”ç”¨å±‚é›†æˆ

## ğŸ”„ æ•°æ®æµæ¶æ„

### è¯·æ±‚å¤„ç†æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ Next.js Router â†’ tRPC Handler â†’ æƒé™æ£€æŸ¥ â†’ CRUD æ“ä½œ â†’ æ•°æ®åº“
                â†‘              â†‘           â†‘         â†‘          â†‘
            @linch-kit/ui  @linch-kit/trpc  @linch-kit/auth  @linch-kit/crud  @linch-kit/core
```

### Schema é©±åŠ¨æµç¨‹

```
Schema å®šä¹‰ â†’ ç±»å‹ç”Ÿæˆ â†’ API ç”Ÿæˆ â†’ è¡¨å•ç”Ÿæˆ â†’ éªŒè¯è§„åˆ™
     â†‘          â†‘         â†‘         â†‘         â†‘
@linch-kit/schema â†’ @linch-kit/trpc â†’ @linch-kit/ui â†’ è¿è¡Œæ—¶éªŒè¯
```

## ğŸ§  AI é›†æˆæ¶æ„

### Neo4j çŸ¥è¯†å›¾è°±

```
ä»£ç åº“æ‰«æ â†’ AST åˆ†æ â†’ å›¾è°±æ„å»º â†’ å…³ç³»åˆ†æ â†’ AI æŸ¥è¯¢æ¥å£
    â†‘          â†‘         â†‘         â†‘         â†‘
  æºä»£ç     è¯­æ³•æ ‘   Neo4j æ•°æ®åº“  Graph RAG  AI Session å·¥å…·
```

**å›¾è°± Schema**:

- **èŠ‚ç‚¹ç±»å‹**: Package, Function, Class, Interface, Schema
- **å…³ç³»ç±»å‹**: CALLS, EXTENDS, IMPLEMENTS, IMPORTS, DEPENDS_ON
- **æ•°æ®çŠ¶æ€**: 5,446+ èŠ‚ç‚¹ï¼Œ7,969+ å…³ç³»

### AI Session å·¥å…·é›†æˆ

```
bun run ai:session â†’ æ„å›¾è¯†åˆ« â†’ å›¾è°±æŸ¥è¯¢ â†’ ä¸Šä¸‹æ–‡ç”Ÿæˆ â†’ AI å“åº”
        â†‘              â†‘         â†‘         â†‘         â†‘
   å‘½ä»¤è¡Œæ¥å£      NLP å¤„ç†   Neo4j æŸ¥è¯¢   ç»“æ„åŒ–æ•°æ®   æ™ºèƒ½å»ºè®®
```

## ğŸ¯ æ¶æ„æ‰©å±•åŸåˆ™

### æ°´å¹³æ‰©å±• (åŒå±‚æ‰©å±•)

- **æ–°åŒ…**: åœ¨åŒä¸€å±‚çº§æ·»åŠ æ–°çš„åŒ… (å¦‚ @linch-kit/analytics)
- **æ–°æ¨¡å—**: åœ¨æ¨¡å—å±‚æ·»åŠ æ–°çš„ä¸šåŠ¡æ¨¡å—
- **æ–°åº”ç”¨**: åˆ›å»ºæ–°çš„åº”ç”¨é›†æˆç°æœ‰åŠŸèƒ½

### å‚ç›´æ‰©å±• (åŠŸèƒ½å¢å¼º)

- **åŒ…å†…æ‰©å±•**: åœ¨ç°æœ‰åŒ…å†…å¢åŠ æ–°åŠŸèƒ½
- **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®å¯ç”¨æ–°ç‰¹æ€§
- **æ’ä»¶æœºåˆ¶**: é€šè¿‡æ’ä»¶ç³»ç»Ÿæ‰©å±•åŠŸèƒ½

### æ‰©å±•çº¦æŸ

- âœ… **éµå¾ªä¾èµ–æ–¹å‘**: æ–°åŠŸèƒ½ä¸èƒ½è¿åä¾èµ–å±‚æ¬¡
- âœ… **ä¿æŒèŒè´£è¾¹ç•Œ**: åŠŸèƒ½æ·»åŠ è¦ç¬¦åˆåŒ…çš„èŒè´£å®šä¹‰
- âœ… **å‘åå…¼å®¹**: æ–°åŠŸèƒ½ä¸èƒ½ç ´åç°æœ‰ API
- âŒ **ç¦æ­¢å¾ªç¯ä¾èµ–**: ç»ä¸å…è®¸å¼•å…¥å¾ªç¯ä¾èµ–

## ğŸ“Š æ¶æ„å¥åº·æŒ‡æ ‡

### ä»£ç è´¨é‡æŒ‡æ ‡

- **æµ‹è¯•è¦†ç›–ç‡**: core >95%, å…¶ä»– >80%
- **ç±»å‹è¦†ç›–ç‡**: 100% TypeScript ä¸¥æ ¼æ¨¡å¼
- **æ„å»ºæ—¶é—´**: å…¨é‡æ„å»º <10ç§’
- **åŒ…å¤§å°**: æ ¸å¿ƒåŒ… <50KB gzipped

### ä¾èµ–å¥åº·æŒ‡æ ‡

- **ä¾èµ–æ·±åº¦**: æœ€å¤§ä¾èµ–å±‚çº§ â‰¤4
- **å¾ªç¯ä¾èµ–**: 0ä¸ªå¾ªç¯ä¾èµ–
- **å¤–éƒ¨ä¾èµ–**: æœ€å°åŒ–ç¬¬ä¸‰æ–¹ä¾èµ–
- **å®‰å…¨æ¼æ´**: 0ä¸ªé«˜å±æ¼æ´

### æ€§èƒ½æŒ‡æ ‡

- **API å“åº”æ—¶é—´**: å¹³å‡ <200ms
- **é¦–å±åŠ è½½**: <3ç§’
- **æ„å»ºç¼“å­˜å‘½ä¸­ç‡**: >80%
- **çƒ­é‡è½½æ—¶é—´**: <1ç§’

---

## ğŸ“‹ æœ€ç»ˆæ¶æ„ç¡®è®¤æ€»ç»“

### âœ… æ¶æ„åˆ†æéªŒè¯å®Œæˆ

é€šè¿‡å¯¹å®é™…ä»£ç çš„å®Œæ•´åˆ†æå’ŒGeminiä¸“å®¶åå•†ï¼Œæœ€ç»ˆç¡®è®¤LinchKit v9.0æ¶æ„ï¼š

**ä¸‰å±‚æ¶æ„æ¨¡å¼**: Host-Containeræ¨¡å¼ï¼ŒèŒè´£è¾¹ç•Œæ¸…æ™°

1. **apps/starter = è½»é‡çº§å®¿ä¸»å®¹å™¨**
   - æä¾›Next.jsè¿è¡Œç¯å¢ƒå’ŒåŸºç¡€è®¾æ–½ âœ…
   - é€šè¿‡StarterIntegrationManageré›†æˆconsole âœ…
   - æ¸è¿›å¼æ¶æ„ï¼šä»ç©ºshellåˆ°ä¼ä¸šåº”ç”¨ âœ…

2. **extensions/console = ä¼ä¸šåŠŸèƒ½åº“ v2.0.3**
   - æˆç†Ÿçš„ä¼ä¸šçº§ç®¡ç†åŠŸèƒ½å®ç° âœ…
   - StarterIntegrationManagerä¸“é—¨å¤„ç†é›†æˆ âœ…
   - éœ€è¦å®¿ä¸»åº”ç”¨ï¼Œä¸æ˜¯ç‹¬ç«‹åº”ç”¨ âœ…

3. **packages/* = å®Œæ•´åŸºç¡€è®¾æ–½å±‚**
   - @linch-kit/core: ExtensionManager + æ ¸å¿ƒåŠŸèƒ½ âœ…
   - @linch-kit/platform: PlatformManager + ä¸šåŠ¡æ”¯æŒ âœ…
   - @linch-kit/auth: NextAuth.jså®Œæ•´é›†æˆ âœ…
   - @linch-kit/ui: shadcn/uiä¼ä¸šçº§ç»„ä»¶åº“ âœ…

### ğŸ¯ å…³é”®æ¶æ„åŸåˆ™

- **èŒè´£è¾¹ç•Œæ¸…æ™°**: starter=å®¿ä¸»å®¹å™¨, console=åŠŸèƒ½åº“, packages=åŸºç¡€è®¾æ–½
- **Host-Containeræ¨¡å¼**: é¿å…èŒè´£å€’ç½®ï¼Œæ˜ŸçŠ¶ä¾èµ–å…³ç³»
- **åŸºäºç°æœ‰å®ç°**: æ¶æ„è®¾è®¡åŸºäºå®é™…ä»£ç éªŒè¯ï¼Œä¸æ˜¯ç†è®ºè®¾è®¡
- **æˆç†ŸæŠ€æœ¯æ ˆ**: NextAuth.jsã€shadcn/uiã€ExtensionManagerç­‰æˆç†Ÿå®ç°

**æ ¸å¿ƒåŸåˆ™**: è¿™ä¸ªæ¶æ„æ˜¯åŸºäºå®é™…ä»£ç åˆ†æç¡®è®¤çš„æœ€ç»ˆç‰ˆæœ¬ï¼Œæ‰€æœ‰å¼€å‘æ´»åŠ¨éƒ½åº”è¯¥éµå¾ªè¿™ä¸ªæ¶æ„è®¾è®¡è¿›è¡Œã€‚
